<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Pietro F. Maggi</title>
    <link>http://pietromaggi.com/tags/stagenow/index.xml</link>
    <description>Recent content on Pietro F. Maggi</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-EN</language>
    <managingEditor>pfm@pietromaggi.com (Pietro F. Maggi)</managingEditor>
    <webMaster>pfm@pietromaggi.com (Pietro F. Maggi)</webMaster>
    <copyright>(c) 2013-2016 Pietro F. Maggi</copyright>
    <atom:link href="http://pietromaggi.com/tags/stagenow/index.xml" rel="self" type="application/rss+xml" />
    
    <item>
      <title>Managing Display AutoRotation from StageNow</title>
      <link>http://pietromaggi.com/2016/06/07/managing-display-autorotation-from-stagenow/</link>
      <pubDate>Tue, 07 Jun 2016 20:00:00 +0100</pubDate>
      <author>pfm@pietromaggi.com (Pietro F. Maggi)</author>
      <guid>http://pietromaggi.com/2016/06/07/managing-display-autorotation-from-stagenow/</guid>
      <description>

&lt;p&gt;Another busy day with enquiry about our devices/tools.&lt;br /&gt;
The funny thing is that, most of the time, answer to a question with another one is actually a good strategy :-)&lt;/p&gt;

&lt;p&gt;This one cames from my colleague Raymond:&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;Can we launch an adb commands from Stagenow?&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;The quick answer is no, the right answer is: &lt;em&gt;what are you trying to achieve?&lt;/em&gt;&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;I need a way to disable the Disaply AutoRotate setting, something that is possible to do using an &lt;code&gt;adb shell&lt;/code&gt; command:&lt;/p&gt;
&lt;/blockquote&gt;

&lt;pre&gt;&lt;code&gt;adb shell content insert --uri content://settings/system --bind name:s:accelerometer_rotation 
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Ok, so the real question is:&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;Can I disable Display AutoRotation using StageNow?&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;In this case the answer is yes, with some little help.
&lt;img src=&#34;http://pietromaggi.com/images/autorotate/disable.gif&#34; alt=&#34;Disable AutoRotate&#34; title=&#34;Disable AutoRotate&#34; /&gt;&lt;/p&gt;

&lt;h2 id=&#34;the-blueprint&#34;&gt;The blueprint&lt;/h2&gt;

&lt;p&gt;The idea to implement this is to have an application on the device that can disable this setting&amp;hellip;&lt;br /&gt;
Ok, so not really ground-breaking. But wait, there&amp;rsquo;s more.&lt;br /&gt;
Instead of having an application that blindly disable this setting, we can build it so that we can launch it with different arguments and act on the arguments.&lt;/p&gt;

&lt;p&gt;To give you the complete picture, we can think that to implement the complete solution we need few steps in StageNow:&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;Install the application on the device&lt;/li&gt;
&lt;li&gt;Launch the application with the proper argument (activate or deactivate AutoRotate in this case)&lt;/li&gt;
&lt;li&gt;Uninstall the application (optional step)&lt;/li&gt;
&lt;/ol&gt;

&lt;h3 id=&#34;writing-to-the-settings&#34;&gt;Writing to the settings&lt;/h3&gt;

&lt;p&gt;An Android application can update the settings if it has the permission:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;android.permission.WRITE_SETTINGS
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Just keep in mind that &lt;a href=&#34;https://developer.android.com/reference/android/Manifest.permission.html#WRITE_SETTINGS&#34;&gt;this does not allow full access to the settings&lt;/a&gt;, since Android v4.2.2, Google moved some of the settings under the &lt;em&gt;Secure Settings&lt;/em&gt; that requires a different permission that can be granted only to application that resides in the system folder or are signed with the platform keys. For additional information take a look at &lt;a href=&#34;https://developer.android.com/reference/android/Manifest.permission.html#WRITE_SECURE_SETTINGS&#34;&gt;&lt;code&gt;android.permission.WRITE_SECURE_SETTINGS&lt;/code&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Given that you application has the permission to write to the settings you can use the following code to write a new value to the AutoRotate setting:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;android.provider.Settings.System.putInt(getContentResolver(), Settings.System.ACCELEROMETER_ROTATION, value);
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;using-intent-extra-parameters&#34;&gt;Using Intent extra parameters&lt;/h3&gt;

&lt;p&gt;Ok, now that we&amp;rsquo;ve a way to set the settings, we want to have a way to get a parameter from StageNow to decide if we&amp;rsquo;ve to enable or disable the Display AutoRotate setting.&lt;br /&gt;
To do this we can use some extra parameters in the Intent that is used to launch our application:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;private final static String KEY_ROTATION = &amp;quot;AutoRotate&amp;quot;;

Bundle extras = getIntent().getExtras();
if (extras != null) {
    value = extras.getInt(KEY_ROTATION);
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Now, from the command line, &lt;code&gt;adb shell&lt;/code&gt; to send the right parameter to our sample app:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;adb shell am start -n com.pietromaggi.sample.autorotate/.MainActivity --ei &amp;quot;AutoRotate&amp;quot; 0 
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;putting-the-different-pieces-together&#34;&gt;Putting the different pieces together&lt;/h2&gt;

&lt;p&gt;To keep things simple, I&amp;rsquo;ve build a very simple demo application that implement these two features, and then closes the activity.&lt;br /&gt;
you can find the source code &lt;a href=&#34;https://github.com/pfmaggi/autorotate&#34;&gt;in this github repository&lt;/a&gt; and the &lt;a href=&#34;https://github.com/pfmaggi/autorotate/releases/download/v1.0.0/autorotate.apk&#34;&gt;final release apk here&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;This on the device, we now need to put together the StageNow profile that install the apk and then send the intent to our application.&lt;/p&gt;

&lt;p&gt;To create the StageNow profile use the Expert Mode and add these steps:&lt;/p&gt;

&lt;h3 id=&#34;1-file-manager-to-copy-the-apk-on-the-device&#34;&gt;1. File Manager - to copy the apk on the device&lt;/h3&gt;

&lt;p&gt;&lt;img src=&#34;http://pietromaggi.com/images/autorotate/StageNow_1.png&#34; alt=&#34;Copy AutoRotate apk on the device&#34; title=&#34;Copy AutoRotate apk on the device&#34; /&gt;&lt;/p&gt;

&lt;h3 id=&#34;2-app-manager-to-install-update-the-apk&#34;&gt;2. App Manager - to install/update the apk&lt;/h3&gt;

&lt;p&gt;&lt;img src=&#34;http://pietromaggi.com/images/autorotate/StageNow_2.png&#34; alt=&#34;Install/update the apk&#34; title=&#34;Install/update the apk&#34; /&gt;&lt;/p&gt;

&lt;h3 id=&#34;3-intent-manager-to-launch-the-autorotate-app-with-the-disable-parameter&#34;&gt;3. Intent Manager - to launch the autorotate app with the disable parameter&lt;/h3&gt;

&lt;p&gt;&lt;img src=&#34;http://pietromaggi.com/images/autorotate/StageNow_3.png&#34; alt=&#34;launch the autorotate app with the disable parameter&#34; title=&#34;launch the autorotate app with the disable parameter&#34; /&gt;&lt;/p&gt;

&lt;h3 id=&#34;4-app-manager-uninstall-the-apk&#34;&gt;4. App Manager - uninstall the apk&lt;/h3&gt;

&lt;p&gt;&lt;img src=&#34;http://pietromaggi.com/images/autorotate/StageNow_4.png&#34; alt=&#34;uninstall the apk&#34; title=&#34;uninstall the apk&#34; /&gt;&lt;/p&gt;

&lt;h2 id=&#34;testing&#34;&gt;Testing&lt;/h2&gt;

&lt;p&gt;Once we&amp;rsquo;ve created the StageNow profile, it&amp;rsquo;s simply a matter of putting the device on the same network of the StageNow server and scan the two barcodes.&lt;br /&gt;
The StageNow client on the device will start downloading the apk, installing it, etc. reporting a staging succesful message at the end&amp;hellip; hopefully :-)&lt;/p&gt;

&lt;h2 id=&#34;where-to-go-from-here&#34;&gt;Where to go from here&lt;/h2&gt;

&lt;p&gt;A natural evolution of this technique would be to add more settings handling to this sample app, assigning a different Intent Extra to every parameter, so we can use a single application to manage multiple settings.&lt;/p&gt;

&lt;p&gt;Let me know if you&amp;rsquo;ve any comment/request about this topic.&lt;/p&gt;
</description>
    </item>
    
  </channel>
</rss>